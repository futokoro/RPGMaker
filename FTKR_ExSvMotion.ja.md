[トップページに戻る](README.md)

# [FTKR_ExSvMotion](FTKR_ExSvMotion.js) プラグイン

SVキャラのモーションを拡張するプラグインです。

ダウンロード: [FTKR_ExSvMotion.js](https://raw.githubusercontent.com/futokoro/RPGMaker/master/FTKR_ExSvMotion.js)

# 目次

以下の項目の順でプラグインの使い方を説明します。
1. [概要](#概要)
2. [プラグインの登録](#プラグインの登録)
1. [基本仕様](#基本仕様)
2. [行動モーションの設定](#行動モーションの設定)
    1. [スキル_アイテムに個別でモーションを設定](#スキル・アイテムに個別でモーションを設定)
2. [状態モーションの設定](#状態モーションの設定)
    1. [アクターの状態(Condition)の設定](#アクターの状態(Condition)の設定)
    2. [カスタムコンディションの設定](#カスタムコンディションの設定)
    2. [状態モーションの優先度](#状態モーションの優先度)
    3. [モーションのコード(Name)の設定](#モーションのコード(Name)の設定)
    3. [ステートモーションの設定](#ステートモーションの設定)
2. [別画像のモーションの設定](#別画像のモーションの設定)
3. [カスタムモーションの作成](#カスタムモーションの作成)
* [プラグインの更新履歴](#プラグインの更新履歴)
* [拡張プラグイン](#拡張プラグイン)
* [ライセンス](#ライセンス)

# 概要

当プラグインを実装することで、アクターのSVキャラのモーションを拡張します。

1. 行動モーションの変更
    * 攻撃やスキル、アイテムなどアクターの行動によって表示するモーション(行動モーション)を変更できます。
    * データベースで設定したアクターのSV画像以外の画像を使用できます。
1. 状態モーションの変更
    * 詠唱や防御、状態異常などアクターの状態によって表示するモーション(状態モーション)を追加・変更できます。
    * アクターの状態によるモーション表示の優先度の変更できます。
    * ステートに掛かっている時のモーションを、デフォルトの4種以外に設定できます。
1. カスタムモーションの作成
    * 複数のモーションを組み合わせてオリジナルのモーションを作ることができます。

# プラグインの登録

以下のプラグインと組み合わせて使用する場合は。
プラグイン管理画面で、以下の順の配置になるように登録してください。
```
YEP_BattleEngineCore.js
YEP_X_AnimatedSVEnemies.js
YED_SideviewBattler.js
FTKR_ExSvMotion.js
```

# 基本仕様

当プラグインでは以下のようにモーションを種類分けしています。

### 行動モーション
攻撃やダメージ、スキル使用など、アクターの行動時に表示するモーションを行動モーションとします。
モーションはループせず、１動作のモーションを実行すると停止します。

### 状態モーション
待機や詠唱、状態異常など、アクターが特定の状態・ステートになっている間表示しつづけるモーションを状態モーションとします。
モーションはループし、アクターの状態が変わるか、アクターが行動するまで同じモーションをとり続けます。

# 行動モーションの設定

行動モーションに対して使用するモーション画像を変更することができます。
デフォルトの設定は以下の通りです。

| アクターの行動 | コードの設定 | プラグインパラメータ |
| --- | --- | --- |
| ダメージを受ける | damage | Damage Motion |
| 回避する | evade | Evade Motion |
| 突き攻撃 | thrust | Thrust Motion |
| 払い攻撃 | swing | Swing Motion |
| 飛び道具攻撃 | missile | Missile Motion |
| スキル使用 | skill | Skill Motion |
| SV魔法スキル使用 | spell | Spell Motion |
| アイテム使用 | item | Item Motion |
| 回復を受ける | ---- | Recovery Motion |

アクターの行動時に、各プラグインパラメータに設定したコードのモーションを表示します。

設定可能なコードは、[こちら](Code_List.ja.md#モーション)を参照してください。

コードに`custom*`と入力することで、カスタムモーションを使用できます。<br>
コードに`other*`と入力することで、別画像のモーションを使用できます。

## スキル_アイテムに個別でモーションを設定
スキル、アイテムのメモ欄に以下のタグを設定すると、使用時のモーションを変更することができます。
この設定は、プラグインパラメータの設定よりも優先します。
```
<ESM モーション: name>
<ESM MOTION: name>
```
使用時のモーションを name に変更します。
name にはモーションのコードを設定してください。

```
<ESM 武器モーション>
<ESM WEAPON_MOTION>
```
このタグがあると、手持ちの武器付きのモーションになります。

```
<ESM 詠唱ON>
<ESM CHANT_ON>
```
このタグがあると、スキル実行待機中のモーションを詠唱モーションに設定できます。

```
<ESM 詠唱OFF>
<ESM CHANT_OFF>
```
このタグがあると、詠唱モーションをOFFに設定できます。
SV魔法スキルに設定したスキルであっても、詠唱モーションを実行しません。

[目次に戻る](#目次)

# 状態モーションの設定

状態モーションは、状態モーション1～状態モーション16まで設定できます。

デフォルトの設定は以下の通りです。

| モーション番号 | 名称 | 状態コード(Condition) | モーションコード名(Name) |
| --- | --- | --- | --- |
| 1 | 瀕死時 | dying | dying |
| 2 | 状態異常中 | state1 | abnormal |
| 3 | 防御中 | guard | guard |
| 4 | 詠唱中 | chant | chant |
| 5 | 睡眠中 | state2 | sleep |
| 6 | 空き |  |  |
| 7 | 空き |  |  |
| 8 | 戦闘不能中 | state3 | dead |
| 9 | コマンド入力中 | input | walk |
| 10 | 戦闘勝利時 | victory | victory |
| 11 | 逃走時 | escape | escape |
| 12 | 空き |  |  |
| 13 | 空き |  |  |
| 14 | 空き |  |  |
| 15 | 空き |  |  |
| 16 | 空き |  |  |

表中の名称は状態コード(Condition)の意味を示しているだけで、特に設定されているものではありません。

## アクターの状態(Condition)の設定

プラグインパラメータ`<Motion * Condition>`で設定するもので、この記述でアクターの状態を判定します。

アクターの状態には以下の種類があります。

| 状態コード | 状態の意味 | 備考 |
| --- | --- | --- |
| input   | コマンド入力中 |  |
| chant   | 詠唱中 |  |
| guard   | 防御中/防御待機中 |  |
| state*  | ステート付加中 | state + ステートモーション番号<br>例 : state4 |
| victory | 戦闘勝利中 |  |
| escape  | 逃走中 |  |
| dying   | 瀕死時 | 残りHP25％以下 |
| custom* | カスタム | custom + カスタムコンディション番号<br>例 : custom1 |

ステートモーション番号の 1 ~ 3は、基本設定で選べる以下の状態を示します。
* 1 - 状態異常
* 2 - 睡眠
* 3 - 戦闘不能

## カスタムコンディションの設定

状態コードを`custom*`と設定すると、独自の条件式を設定することができます。
カスタムコンディション番号と同じ番号の、プラグインパラメータ`<Custom Condition *>` にJS条件式を入力してください。

[条件式 の値について]
条件式は、ダメージ計算式のように、計算式を入力することで、固定値以外の値を使用することができます。
以下のコードを使用できます。
* a.param - 使用者のパラメータを参照します。(a.hit で使用者の命中率)
* v[x]    - 変数ID x の値を参照します。
* s[x]    - スイッチID x の値を参照します。

入力例)<br>
以下のスクリプトで、残りHP50％以下の状態を意味します。
```
a.hpRate() * 100 <= 50
```

## 状態モーションの優先度

アクターは一度に複数の状態を満たす場合があります。
例えば、瀕死時に防御する、状態異常中に詠唱するなどです。

表示できるモーションは１つだけなため、どのモーションを表示するか決めるものがモーションの優先度です。

上の表のモーション番号の数字が大きいほど、モーションの優先度が高くなります。
先ほどの例の場合、デフォルト設定では瀕死時に防御すると防御のモーションが優先されます。

設定例）<br>
状態モーション1に設定されている瀕死状態を、空きの状態モーション6に設定しなおした場合、瀕死状態のモーションは、状態異常、防御、詠唱、睡眠状態よりも優先されるようになります。

## モーションのコード(Name)の設定

プラグインパラメータ`<Motion * Name>`で設定するもので、この記述で指定した状態の時に表示するモーションを決定します。

設定可能なコードは、[こちら](Code_List.ja.md#モーション)を参照してください。

コードに`custom*`と入力することで、カスタムモーションを使用できます。<br>
コードに`other*`と入力することで、別画像のモーションを使用できます。

[目次に戻る](#目次)

## ステートモーションの設定

通常ステート付加中に表示できるモーションは、状態異常、睡眠、戦闘不能の３種類ですが、当プラグインではステートのメモ欄に以下のタグを入力することで、ステート付加中のモーションを設定できます。

```
<ESM モーション: x>
<ESM MOTION: x>
```
ステートモーション番号を x に設定します。
タグで設定しない場合は、基本設定の[SV]モーションの設定に従います。

ステートモーション番号の 1 ~ 3は、基本設定で選べる以下の状態を示します。
* 1 - 状態異常
* 2 - 睡眠
* 3 - 戦闘不能

モーション番号を 4 以上に設定する場合、状態モーションの設定で state4 以上を追加し、モーションコードを設定しなくてはいけません。

また、以下のタグを記入すると、ステート付与直前のモーションの状態で固定し、それ以降のモーション更新を無効にします。
```
<ESM モーション無効>
<ESM FIXED_MOTION>
```
例えば、防御モーション中にこのステートが付与されると、防御モーションで固定され、以降このステートが解除されるまで何があっても防御モーションをとり続けます。

[目次に戻る](#目次)

# 別画像のモーションの設定
モーションコードで`other*` (* は数字)で指定するモーションは、当プラグインで新規に設定可能なアクター専用のモーションです。

データベースのアクターの「画像」設定で選択したSV戦闘キャラ画像以外の画像を使用することができます。

使用する画像は、アクターのメモ欄に以下のタグで設定します。
```
<ESM_画像:filename>
<ESM_IMAGE:filename>
```

画像ファイル filename.png は img/sv_actors/ に保存してください。
使用できる画像規格は、SV戦闘キャラ画像と同じです。

other*の *番号は、画像内のどの位置のモーションを使用するか設定する番号です。
3枚で1セットで左上のモーションを0番、一つ下を1番、一つ右を6番として数えます。
other0 ~ other17 まで使用できます。

なお、別画像モーションはループしません。
また、カスタムモーションに使用できます。

[目次に戻る](#目次)

# カスタムモーションの作成
モーションコードで`custom*`(* は数字)と指定するモーションは、本プラグインで新規に設定可能なモーションです。

以下のプラグインパラメータで表示するモーションのコードを設定することで複数のモーションを連続して表示させることができます。
カスタムモーションは、8個まで設定できます。

`<CustomNon * Loop>`<br>
このパラメータに設定したコードのモーションはループしません。

`<Custom * Loop>`<br>
このパラメータに設定したコードのモーションをループさせます。

モーションのコードは、カンマ(,)を使うことで複数入力できます。

### モーションのループについて

`<Custom * Loop>`に設定したモーションをループさせます。
複数のコードを入力した場合も、それらを順に表示してループします。

### 設定例
```
<CustomNon 1 Loop> :victory, skill
<Custom 1 Loop>    :item, walk
```
上記のように設定した場合、以下の順番でモーションを表示します。

```
victory ⇒ skill ⇒ item ⇒ walk ⇒ item ⇒ walk ⇒ ...
                 |→ここからループ
```

[目次に戻る](#目次)

## プラグインの更新履歴

| バージョン | 公開日 | 更新内容 |
| --- | --- | --- |
| [ver1.3.1](FTKR_ExSvMotion.js) | 2018/05/31 | パーティーの誰かが防御を使用すると、パーティーメンバー全員が防御モーションを一瞬実行する不具合を修正 |
| ver1.3.0 | 2018/05/22 | 特定のステート付与中のモーションの更新を無効にする機能を追加 |
| ver1.2.10 | 2018/04/29 | 状態モーションにループしないモーションを設定すると、エラーになる不具合を修正 |
| ver1.2.9 | 2018/04/28 | デバッグ設定のログ表示を有効にすると、特定のモーション時にエラーになる不具合を修正 |
| ver1.2.8 | 2018/04/28 | YEP_BattleEngineCore.jsと組み合わせている場合に、戦闘不能時の状態モーションの設定が反映されない不具合を修正 |
| ver1.2.7 | 2018/04/12 | YEP_VictoryAftermath.jsと組み合わせた場合に、勝利モーションを実行しない不具合を修正 |
| ver1.2.6 | 2018/04/10 | YED_SideviewBattlerと組み合わせた場合に、3フレーム以外のモーションを表示できない不具合を修正<br>スキルに詠唱モーションを実行させるタグ付け機能を追加 |
| ver1.2.5 | 2017/08/24 | メモ欄の読み取り処理を見直し |
| ver1.2.4 | 2017/07/09 | 状態モーションのescapeが、戦闘時以外でも有効になる不具合を修正<br>戦闘終了時に、アクターのアクションをリセットする機能を追加 |
| ver1.2.3 | 2017/05/19 | 防御モーションの優先度が反映されない不具合を修正 |
| ver1.2.2 | 2017/05/11 | 余計なログを出力する箇所を削除<br>FTKR_FacialImageDifferenceのv1.0.1に対応 |
| ver1.2.1 | 2017/05/10 | FTKR_FacialImageDifferenceの対応が不十分だった箇所を修正 |
| ver1.2.0 | 2017/05/09 | 別のSV画像を使用したモーションを設定する機能を追加<br>スキル・アイテムの使用モーションを個別に設定する機能を追加<br>HP回復時のモーションを設定する機能を追加<br>状態モーションに独自条件を設定するカスタムコンディションの機能を追加 |
| ver1.1.5 | 2017/05/06 | ステートモーションタグが設定されていない場合に、ステートのモーションを正しく反映できない不具合を修正 |
| ver1.1.4 | 2017/04/30 | YED_SideviewBattlerの対応が不十分だった箇所を修正 |
| ver1.1.3 | 2017/04/27 | requestMotion()に関する不具合修正<br>YED_SideviewBattlerに対応<br>YEP_X_AnimatedSVEnemiesに対応 |
| ver1.1.2 | 2017/04/27 | 状態モーション10以降が反映されない不具合修正 |
| ver1.1.1 | 2017/04/26 | YEP_BattleEngineCoreに対応 |
| ver1.1.0 | 2017/04/25 | 攻撃等の行動モーションを変更する機能を追加<br>状態モーションに、戦闘勝利、逃走、瀕死時のモーションを追加<br>状態モーションのデフォルト設定を見直し<br>複数のモーションを組み合わせて連続で表示する機能を追加 |
| ver1.0.1 | 2017/04/21 | ステートのメモ欄が正しく読み取れない不具合修正 |
| ver1.0.0 | 2017/04/19 | 初版公開 |

[目次に戻る](#目次)

## 拡張プラグイン

以下のプラグインを使用することで、本プラグインの機能を拡張できます。

* [FTKR_FacialImageDifference.js](FTKR_FacialImageDifference.ja.md) - メニュー画面等で表示する顔画像をアクターの状態で変更できます。

## ライセンス

本プラグインはMITライセンスのもとで公開しています。

[The MIT License (MIT)](https://opensource.org/licenses/mit-license.php)

#
[目次に戻る](#目次)

[トップページに戻る](README.md)