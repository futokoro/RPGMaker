[トップページに戻る](README.md)

# [FTKR_ExItemConfig_Activate](FTKR_ExItemConfig_Activate.js) プラグイン

アイテムとスキルの発動設定を拡張するプラグインです。<br>
本プラグインは、FTKR_SkillExpansion.jsと組み合わせて使用できません。

ダウンロード: [FTKR_ExItemConfig_Activate.js](https://raw.githubusercontent.com/futokoro/RPGMaker/master/FTKR_ExItemConfig_Activate.js)

## 目次

以下の項目の順でプラグインの使い方を説明します。
1. [概要](#概要)
2. [連続回数の設定](#連続回数の設定)
3. [発動失敗処理について](#発動失敗処理について)
4. [命中および回避処理について](#命中および回避処理について)
* [プラグインの更新履歴](#プラグインの更新履歴)
* [ライセンス](#ライセンス)

## 概要

本プラグインを実装することで、アイテムやスキルの発動設定をより詳細に設定できます。

1. 連続回数をJS計算式で設定できます。
2. 成功率をJS計算式で設定できます。
3. 成功判定、命中判定、回避判定の計算処理を変更できます。
4. アイテム/スキル毎に命中率をJS計算式で設定できます。

## 連続回数の設定

アイテムやスキルに以下のノートタグを追記することで、連続回数の設定ができます。
```
<EIC 発動設定>
code
</EIC 発動設定>
```

### code に使用できる項目
```
Count: eval
連続回数: 計算式
```
連続回数を 計算式(eval) の値に変更します。

```
Success Rate: eval
成功率: 計算式
```
成功率を 計算式(eval) の値に変更します。

```
Hit Rate: eval
命中率: 計算式
```
プラグインパラメータの設定に関わらずに命中率を計算式(eval) の値に変更します。

```
Eva Rate: eval
回避率: 計算式
```
プラグインパラメータの設定に関わらずに回避率を計算式(eval) の値に変更します。

### 計算式(eval) の値について
計算式(eval)は、ダメージ計算式のように、計算式を入力することで、固定値以外の値を使用することができます。以下のコードを使用できます。
* a.param - 使用者のパラメータを参照します。(a.atk で使用者の攻撃力)
* b.param - 対象者のパラメータを参照します。
* s[x]    - スイッチID x の状態を参照します。
* v[x]    - 変数ID x の値を参照します。
* iv[x]   - アイテムのセルフ変数ID x の値を参照します。(*1)
* BattleManager._repeatCount - 1撃目を 0 として連続回数を参照します。(*2)

(*1) セルフ変数を使用する場合は、FTKR_ItemSelfVariables.jsが必要です。<br>
(*2) 本プラグインが有効であれば、このコードを別のプラグインの計算式に使用できます。

### 入力例
スキルを5回連続で使用するが、1回毎に成功率が10%ずつ下がる。
1回目が100%、2回目は90%、3回目は80%、...となる。
使用者の命中率に+10%の補正を加える。
```
<EIC 発動設定>
連続回数: 5
成功率: 1 - BattleManager._repeatCount0.1
命中率: a.hit + 0.1
</EIC 発動設定>
```

### 連続攻撃中の発動失敗について

以下のプラグインパラメータで設定を変更できます。

```
<Enabled Repeat Failure>
```
連続攻撃中にアイテム/スキルが失敗、命中しない、回避される等するとその時点で攻撃をやめるかどうか設定できます。
* 0 - 攻撃を続けます
* 1 - 攻撃をやめます

## 発動失敗処理について

MVの標準仕様では、アイテム/スキルの発動失敗(成功率の判定で失敗)した場合は
命中しなかった、という扱いになります。
そのため、バトルログは命中しない場合のメッセージを表示します。

本プラグインでは、成功率の判定を命中率とは別に行い、失敗時のメッセージも
別にすることができます。
以下のプラグインパラメータで設定します。

```
<Enabled Action Failure>
```
発動失敗時の専用メッセージを使用するか設定します。
* 0 - 使用しない
* 1 - 使用する
使用するに設定した場合、まず成功率だけで判定を行います。

```
<Action Failure Message>
```
発動失敗時の専用メッセージを設定します。
%1 は使用者の名前, %2 はアイテム/スキルの名前に変更します。

## 命中および回避処理について

MVの標準仕様では、アイテム/スキルの命中と回避の処理は以下の流れになっています。

1. 使用者の命中率とアイテム/スキルの成功率を参照して命中するかどうか判定する。
2. 命中判定に成功した場合、対象の回避率を参照して対象が回避するかどうか判定する。

このため、命中率は100%以上は意味がなく、対象に回避率が有る場合は、命中率が100%あっても回避される可能性があります。

これに対して、本プラグインでは、命中と回避の処理を変更することができます。
例えば、使用者の命中率から対象の回避率を引く、といった処理に変えることや命中率と回避率以外のパラメータを使用することができるようになります。

以下のプラグインパラメータで設定します。

```
<Enabled Custom Hit>
```
命中の計算式を変更するか設定します。
1 にすることで後述の計算式が有効になります。
なお、アイテム/スキルのメモ欄で命中率の設定をしている場合はこのパラメータの設定に関わらず、その値を使用します。

```
<Physical Hit Formula>
<Magical Hit Formula>
```
命中の計算式を設定します。
Physical~ で物理タイプの命中率、Magical~ で魔法タイプの命中率を
設定します。
1 に設定すると、必ず命中します。

```
<Enabled Custom Eva>
```
回避の計算式を変更するか設定します。
1 にすることで後述の計算式が有効になります。

```
<Physical Eva Formula>
<Magical Eva Formula>
```
回避の計算式を設定します。
Physical~ で物理タイプの回避率、Magical~ で魔法タイプの回避率を設定します。
0 に設定すると、回避されなくなります。

### 計算式(eval) の値について
計算式(eval)は、ダメージ計算式のように、計算式を入力することで、
固定値以外の値を使用することができます。以下のコードを使用できます。
* a.param - 使用者のパラメータを参照します。(a.atk で使用者の攻撃力)
* b.param - 対象者のパラメータを参照します。
* s[x]    - スイッチID x の状態を参照します。
* v[x]    - 変数ID x の値を参照します。
* iv[x]   - アイテムのセルフ変数ID x の値を参照します。(*1)
* BattleManager._repeatCount - 1撃目を 0 として連続回数を参照します。

(*1) セルフ変数を使用する場合は、FTKR_ItemSelfVariables.jsが必要です。

### 設定例
#### 命中 - 回避にする場合
命中側の処理で、命中 - 回避の計算を行い、回避処理は無視する。
この場合は回避メッセージを表示することはありません。
命中処理
```
<Enabled Custom Hit> 1
<Physical Hit Formula> : a.hit - b.eva
<Magical Hit Formula>  : 1 - b.mev
```
回避処理
```
<Enabled Custom Eva> 1
<Physical Eva Formula> : 0
<Magical Eva Formula>  : 0
```

#### 命中率が 100%を超えた分を、対象の回避から減らす場合
命中処理(変更しない)
```
<Enabled Custom Hit> 0
```
回避処理
```
<Enabled Custom Eva> 1
<Physical Eva Formula> : b.eva - Math.max(a.hit - 1, 0)
<Magical Eva Formula>  : b.mev
```

[目次に戻る](#目次)

## プラグインの更新履歴

| バージョン | 公開日 | 更新内容 |
| --- | --- | --- |
| [ver1.0.2](FTKR_ExItemConfig_Activate.js) | 2017/05/11 | 不具合修正 |
| ver1.0.1 | 2017/04/29 | FTKR_ItemSelfVariables の v1.1.0以降に対応 |
| ver1.0.0 | 2017/04/14 | 初版公開 |

## ライセンス

本プラグインはMITライセンスのもとで公開しています。

[The MIT License (MIT)](https://opensource.org/licenses/mit-license.php)

#
[目次に戻る](#目次)

[トップページに戻る](README.md)